<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Triply | Booking Management</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600&family=Roboto&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    />
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet" />
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Topbar -->
    <div class="container-fluid bg-primary px-5 d-none d-lg-block">
      <div class="row gx-0">
        <div class="col-lg-8 text-center text-lg-start mb-2 mb-lg-0">
          <div class="d-inline-flex align-items-center" style="height: 45px">
            <a
              class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2"
              href="#"
              ><i class="fab fa-twitter"></i
            ></a>
            <a
              class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2"
              href="#"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a
              class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2"
              href="#"
              ><i class="fab fa-linkedin-in"></i
            ></a>
            <a
              class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2"
              href="#"
              ><i class="fab fa-instagram"></i
            ></a>
          </div>
        </div>

        <div class="col-lg-4 text-center text-lg-end">
          <div
            id="topbarUserArea"
            class="d-inline-flex align-items-center"
            style="height: 45px"
          ></div>
        </div>
      </div>
    </div>

    <!-- Navbar -->
    <div class="container-fluid position-relative p-0">
      <nav
        class="navbar navbar-expand-lg navbar-light px-4 px-lg-5 py-3 py-lg-0"
      >
        <a href="index.html" class="navbar-brand p-0">
          <h1 class="m-0"><i class="fa fa-map-marker-alt me-3"></i>Triply</h1>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarCollapse"
        >
          <span class="fa fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <div class="navbar-nav ms-auto py-0">
            <a href="index.html" class="nav-item nav-link">Home</a>
            <a href="about.html" class="nav-item nav-link">About</a>
            <a href="services.html" class="nav-item nav-link">Services</a>
            <a href="packages.html" class="nav-item nav-link">Packages</a>
            <a href="blog.html" class="nav-item nav-link">Blog</a>
            <a href="contact.html" class="nav-item nav-link">Contact</a>
          </div>
          <a
            href="booking.html"
            class="btn btn-primary rounded-pill py-2 px-4 ms-lg-4"
            >Book Now</a
          >
        </div>
      </nav>

      <!-- Hero -->
      <div class="container-fluid bg-primary py-5 mb-5 hero-header">
        <div class="container py-5 text-center text-white">
          <h1 class="display-3 mb-3" style="color: white">
            Booking Management
          </h1>
          <p class="fs-5">View and manage all customer bookings</p>
        </div>
      </div>
    </div>

    <!-- Booking Table -->
    <div class="container my-5">
      <div class="card shadow border-0 rounded-3">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-primary">
              <i class="fas fa-calendar-check me-2"></i>Booking List
            </h3>
            <div>
              <a
                href="profile.html"
                class="btn btn-outline-secondary rounded-pill me-2"
              >
                <i class="fas fa-arrow-left me-2"></i>Back
              </a>
              <button
                class="btn btn-primary rounded-pill"
                data-bs-toggle="modal"
                data-bs-target="#addBookingModal"
              >
                <i class="fas fa-plus-circle me-2"></i>Add Booking
              </button>
            </div>
          </div>

          <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>#</th>
                <th>Customer</th>
                <th>Package</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Add Booking Modal -->
    <div class="modal fade" id="addBookingModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content rounded-3">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">
              <i class="fas fa-plus-circle me-2"></i>Add New Booking
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addBookingForm">
              <div class="mb-3">
                <label class="form-label">Customer Name</label>
                <input type="text" class="form-control" required />
              </div>
              <div class="mb-3">
                <label class="form-label">Package Name</label>
                <input type="text" class="form-control" required />
              </div>
              <div class="mb-3">
                <label class="form-label">Booking Date</label>
                <input type="date" class="form-control" required />
              </div>
              <div class="mb-3">
                <label class="form-label">Status</label>
                <select class="form-select">
                  <option>Confirmed</option>
                  <option>Pending</option>
                  <option>Cancelled</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary w-100 rounded-pill">
                Save Booking
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="container-fluid footer py-5" style="background-color: #0b1b31">
      <div class="container text-center text-white">
        <p class="mb-0">© 2025 Triply. All rights reserved.</p>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const username = localStorage.getItem("TriplyLoggedIn");
        const role = localStorage.getItem("TriplyRole");

        // Nếu chưa đăng nhập thì quay về login
        if (!username) {
          alert("Please log in first.");
          window.location.href = "login.html";
          return;
        }

        // Chỉ admin mới vào được
        if (role !== "admin") {
          alert("Access denied. Only administrators can view this page.");
          window.location.href = "index.html";
          return;
        }

        const tableBody = document.querySelector("tbody");
        const bookings =
          JSON.parse(localStorage.getItem("triplyBookings")) || [];

        function renderBookings() {
          tableBody.innerHTML = "";

          if (bookings.length === 0) {
            tableBody.innerHTML = `
        <tr>
          <td colspan="9" class="text-center text-muted">No bookings found.</td>
        </tr>`;
            return;
          }

          bookings.forEach((b, i) => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
        <td>${i + 1}</td>
        <td><strong>${
          b.contactName || "N/A"
        }</strong><br><small class="text-muted">${
              b.contactEmail || "N/A"
            }</small></td>
        <td>${b.username || "N/A"}</td>
        <td>${b.tourName || "Unknown"}</td>
        <td>${b.tourLocation || "N/A"}</td>
        <td>${b.tourPrice || "$0"}</td>
        <td>${new Date(b.bookingTimestamp).toLocaleDateString()}</td>
        <td>
          <select class="form-select form-select-sm status-select" data-index="${i}">
            <option value="Pending" ${
              b.status === "Pending" ? "selected" : ""
            }>Pending</option>
            <option value="Confirmed" ${
              b.status === "Confirmed" ? "selected" : ""
            }>Confirmed</option>
            <option value="Cancelled" ${
              b.status === "Cancelled" ? "selected" : ""
            }>Cancelled</option>
          </select>
        </td>
        <td>
          <button class="btn btn-sm btn-outline-danger delete-btn" data-index="${i}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      `;

            tableBody.appendChild(tr);
          });

          // Gắn sự kiện cho dropdown và nút xóa
          attachEventListeners();
        }

        function attachEventListeners() {
          // Cập nhật trạng thái booking
          document.querySelectorAll(".status-select").forEach((select) => {
            select.addEventListener("change", function () {
              const idx = this.getAttribute("data-index");
              const updatedStatus = this.value;
              bookings[idx].status = updatedStatus;
              localStorage.setItem("triplyBookings", JSON.stringify(bookings));
            });
          });

          // Xóa booking
          document.querySelectorAll(".delete-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              const idx = this.getAttribute("data-index");
              if (confirm("Are you sure you want to delete this booking?")) {
                bookings.splice(idx, 1);
                localStorage.setItem(
                  "triplyBookings",
                  JSON.stringify(bookings)
                );
                renderBookings();
              }
            });
          });
        }

        // Khởi tạo
        renderBookings();
      });
    </script>
  </body>
</html>
