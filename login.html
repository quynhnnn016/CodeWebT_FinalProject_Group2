<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Triply - Login</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Triply, Login, Account, Travel Booking" name="keywords" />
    <meta
      content="Login to your Triply account to manage your bookings and explore amazing travel packages."
      name="description"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600&family=Roboto&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap & Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    />

    <!-- Main CSS -->
    <link href="css/style.css" rel="stylesheet" />

    <style>
      body {
        font-family: "Roboto", sans-serif;
        background: linear-gradient(
            rgba(15, 23, 43, 0.7),
            rgba(15, 23, 43, 0.7)
          ),
          url("img/login-bg.jpg") center/cover no-repeat;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .login-box {
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        padding: 40px;
        width: 100%;
        max-width: 420px;
      }

      .login-box h3 {
        text-align: center;
        margin-bottom: 25px;
        font-family: "Jost", sans-serif;
        color: #0d6efd;
        font-weight: 600;
      }

      .form-control {
        border-radius: 50px;
        padding: 10px 20px;
      }

      .btn-login {
        background-color: #0d6efd;
        color: #fff;
        border: none;
        border-radius: 50px;
        width: 100%;
        padding: 12px 0;
        font-weight: 600;
        transition: 0.3s;
      }

      .btn-login:hover {
        background-color: #084ec4;
      }

      .alert {
        display: none;
        margin-top: 15px;
      }

      .text-link {
        color: #0d6efd;
        text-decoration: none;
        font-weight: 500;
      }

      .text-link:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="login-box">
      <h3><i class="fa fa-user-circle me-2"></i>Triply Login</h3>

      <form id="loginForm">
        <div class="mb-3">
          <input
            type="text"
            id="username"
            class="form-control"
            placeholder="Username"
            required
          />
        </div>

        <div class="mb-3">
          <input
            type="password"
            id="password"
            class="form-control"
            placeholder="Password"
            required
          />
        </div>

        <button type="submit" class="btn-login">Login</button>

        <div
          id="loginAlert"
          class="alert text-center"
          role="alert"
        >
          Invalid username or password!
        </div>

        <p class="text-center mt-3">
          Don't have an account?
          <a href="register.html" id="registerLink" class="text-link"
            >Register here</a
          >
        </p>
      </form>
    </div>

    <!-- JS Logic -->
    <script>
      // ====== Default accounts setup ======
      if (!localStorage.getItem("TriplyUsers")) {
        const defaultUsers = [
          {
            username: "admin",
            password: "123456",
            email: "admin@Triply.com",
            role: "admin",
            avatar: "img/admin-avatar.jpg",
            displayName: "Administrator",
          },
          {
            username: "traveler",
            password: "123456",
            email: "user@Triply.com",
            role: "user",
            avatar: "img/user-avatar.jpg",
            displayName: "Traveler",
          },
        ];
        localStorage.setItem("TriplyUsers", JSON.stringify(defaultUsers));
      }

      const form = document.getElementById("loginForm");
      const alertBox = document.getElementById("loginAlert");

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        const users = JSON.parse(localStorage.getItem("TriplyUsers")) || [];

        const found = users.find(
          (user) => user.username === username && user.password === password
        );

        if (found) {
          localStorage.setItem("TriplyLoggedIn", found.username);
          localStorage.setItem("TriplyRole", found.role);
          localStorage.setItem("TriplyAvatar", found.avatar);
          localStorage.setItem("TriplyDisplayName", found.displayName);

          alertBox.classList.remove("alert-danger");
          alertBox.classList.add("alert-success");
          alertBox.textContent = "Login successful! Redirecting...";
          alertBox.style.display = "block";

          // Chuyển hướng dựa trên vai trò
          setTimeout(() => {
            if (found.role === "admin") {
              window.location.href = "adminsite.html";
            } else {
              window.location.href = "profile.html";
            }
          }, 1200);
        } else {
          alertBox.classList.remove("alert-success");
          alertBox.classList.add("alert-danger");
          alertBox.textContent = "Invalid username or password!";
          alertBox.style.display = "block";
        }
      });

      // Registration shortcut
      document
        .getElementById("registerLink")
        .addEventListener("click", function (e) {
          e.preventDefault();
          window.location.href = "register.html";
        });
    </script>

    <!-- Topbar / Auth Control -->
    <script src="js/auth.js"></script>
  </body>
</html>
